<!DOCTYPE html>
<meta charset="utf-8">
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, shrink-to-fit=no"
/>
<style>
@import url(http://fonts.googleapis.com/css?family=Source+Code+Pro:400,600);
      body {font-family: "Source Code Pro", Consolas, monaco, monospace; line-height: 160%; font-size: 16px;  margin: 0; }
      path.link {
        fill: none;
        stroke-width: 2px;
      }
      .node:not(:hover) .nodetext {
        display: none;
      }
      h1 { font-size: 36px; margin: 10px 0; text-transform: uppercase; font-weight: normal;}
      h2, h3 { font-size: 18px; margin: 5px 0 ; font-weight: normal;}
      header {padding: 20px; position: absolute; top: 0; left: 0;}
      a:link { color: #EE3124; text-decoration: none;}
      a:visited { color: #EE3124; }
      a:hover { color: #A4CD39; text-decoration: underline;}
      a:active { color: #EE3124; }

header{
	background-color: #edc5cb;
}

.timeSlider {
	margin: auto;
	position: absolute;
	top: 65%; left: 3%; bottom: 0; right: 0;
}

.node rect {
  cursor: pointer;
  fill: #fff;
  fill-opacity: 0.5;
  stroke: #E31937;
  stroke-width: 1.5px;
}

.node text {
  font: 10px sans-serif;
  pointer-events: none;
}

.link {
  fill: none;
  stroke: #f06579;
  stroke-width: 1.5px;
}

.customersChart{
	margin: auto;
	position: absolute;
	top: 75%; left: 3%; bottom: 0; right: 0;
}

.suppliersChart{
	margin: auto;
	position: absolute;
	top: 75%; left: 3%; bottom: 0; right: 0;
}

.competitorChart{
	margin: auto;
	position: absolute;
	top: 70%; left: 3%; bottom: 0; right: 0;
}

.productsChart{
	margin: auto;
	position: absolute;
	top: 70%; left: 3%; bottom: 0; right: 0;
}

.overlapsChart{
	margin: auto;
	position: absolute;
	top: 70%; left: 3%; bottom: 0; right: 0;
}

.overlapsChart tbody td {
  padding: 10px;
  border: solid 1px #000;
  text-align: center;
  font-weight: bold;
}

.overlapsChart thead th {
  font-size: 300%;
  padding: 10 px;
  border: 3px solid black;
  text-align: center;
}

.overlapsChart thead td {
  padding: 15px;
  border: solid 1px #000;
  text-align: center;
}

.overlapsChart tr:nth-child(even) {background-color: #f2f2f2;}

path {  stroke: #fff; }
path:hover {  opacity:0.9; }
rect:hover {  fill:blue; }
.axis {  font: 10px sans-serif; }
.legend tr{    border-bottom:1px solid grey; }
.legend tr:first-child{    border-top:1px solid grey; }

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {  display: none; }
.legend{
    margin-bottom:76px;
    display:inline-block;
    border-collapse: collapse;
    border-spacing: 0px;
}
.legend td{
    padding:4px 5px;
    vertical-align:bottom;
}
.legendFreq, .legendPerc{
    align:right;
    width:50px;
}

table {
  border-collapse: collapse;
  font: 13px sans-serif;
  width: 720px;
}

th {
  font-weight: bold;
  text-align: right;
  padding-right: 6px;
  min-width: 400px;
}

thead td {
  cursor: s-resize;
  font-weight: bold;
}

tbody tr:first-child td {
  padding-top: 2px;
}

.suppliersChart tbody td {
  padding: 0;
  border-left: solid 1px #000;
}

.suppliersChart tbody rect {
  fill: #E41A38;
}

.suppliersChart tbody tr:hover rect {
  fill: #2ea614;
}

.slice {
    cursor: pointer;
}

.slice .main-arc {
    stroke: #fff;
    stroke-width: 1px;
}

.slice .hidden-arc {
    fill: none;
}

.slice text {
    pointer-events: none;
    dominant-baseline: middle;
    text-anchor: middle;
}

</style>

<head>
        <title>RTN Watch</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script type="text/javascript">
        function hideAllElements() {
			document.getElementById("timeSlider").style.display = "none";
			document.getElementById("riskFactors").style.display = "none";
			document.getElementById("competitorChart").style.display = "none";
			document.getElementById("customersChart").style.display = "none";
			document.getElementById("suppliersChart").style.display = "none";
			document.getElementById("productsChart").style.display = "none";
			document.getElementById("overlapsChart").style.display = "none";
		}
        window.onload = hideAllElements;
        </script>
</head>

<body>
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://unpkg.com/d3-simple-slider"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>

<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
  crossorigin="anonymous"
/>

<div class="container">
	<header align="center" style="width:100%; margin:0 auto;">
        <img src="../figs/collins.png" alt="Collins Aerospace Logo" id="logo" height="100" width="500"/>
        <h1>Collins Shark Visualizer <img src="../figs/shark.png" alt="Collins Shark Logo" id="logo" height="42" width="100"/></h1>
        <div>Author: Rishabh Kaushik</div>
		<div>E-Mail: rishabh.kaushik@rockwellcollins.com</div>
		<div>
			<img src="../figs/raytheon.png" alt="Raytheon Logo" height="100" width="500"/>
		</div>
		<div id="dropdown">Please choose an anlaysis topic:
			<select id="topicSelection" onchange="changeVisualInfo();">
				<option value="none" selected="selected"><------Choose an Analysis Topic------></option>
				<option value="t1">Competitors</option>
				<option value="t2">Customer & Contracts</option>
				<option value="t3">Collins Aerospace Overlaps</option>
				<!--<option value="t4">Financial Outlook</option>-->
				<option value="t5">Products</option>
				<option value="t6">Raw Materials, Suppliers & Seasonality</option>
				<option value="t7">Risk Factors</option>
			</select>
		</div>
		<br>
		<audio src="music/Johnny_Cash_Hurt.mp3" controls>	
			<embed 
				src="music/Johnny_Cash_Hurt.mp3"
				width="300"
				height="90"
				hidden="true"
				loop="true"
				autostart="true"
				mastersound>
		</audio>
		<hr>
    </header>
	
	<div id="timeSlider" class="timeSlider"  align="center">
		<div class="col-sm-2"><p id="value-time"></p></div>
		<div class="col-sm"><div id="slider-time"></div></div>
	</div>
		
	<div id="customersChart" class="customersChart" align="center">
		<p align="center" style="color:#E41A38; font-size:25px;"><b>Raytheon's Customers by Segment in Most Recent Quarter (Q2 - 2019) in %</b></p>
		<p align="center" style="color:#E41A38; font-size:18.5px;"><b>Note: Top Data is in % by Revenue & Bottom Data is in % by Income</b></p>
	</div>
	
	<div id="competitorChart" class="competitorChart" align="center">
	</div>
	
	<div id="productsChart" class="productsChart" align="center">
		<a href="https://www.raytheon.com/capabilities" target="_blank">
			<img src="./imgs/rtnproducts.jpg"></img>
			<img src="./imgs/rtnglossary.jpg"></img>
		</a>
		<img src="./imgs/porters5.png"></img>
	</div>
	
	<div id="overlapsChart" class="overlapsChart" align="center">
		<table>
			<thead>
				<tr>
				<th>Keyword</th>
				<td><img src="../figs/raytheon.png" height="100" width="500"></img></td>
				<td><img src="../figs/collins.png" height="100" width="500"></img></td>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Training</td>
					<td>
						<a href="https://www.raytheon.com/capabilities/training" target="_blank">
							<img src="./imgs/rtn_training.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Products-and-Services/Commercial-Aviation/Service-Solutions/Training.aspx" target="_blank">
							<img src="./imgs/cln_training.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>Simulation</td>
					<td>
						<a href="https://www.raytheon.com/capabilities/products/modsim" target="_blank">
							<img src="./imgs/rtn_simulation.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Products-and-Services/Defense/Simulation-and-Training.aspx" target="_blank">
							<img src="./imgs/cln_simulation.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>Mission & Immersive labs</td>
					<td>
						<a href="https://www.industryweek.com/digital-tools/virtual-reality-factories-and-missiles-take-shape-raytheon" target="_blank">
							<img src="./imgs/rtn_ImmersiveLabs.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Products-and-Services/Defense/Simulation-and-Training/Training-Systems/Coalescence.aspx" target="_blank">
							<img src="./imgs/cln_coalescence.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>Live Virtual Constructive (LVC)</td>
					<td>
						<a href="http://investor.raytheon.com/news-releases/news-release-details/raytheon-and-csc-form-alliance-pursue-us-army-warfighter?ID=818036&c=84193&p=irol-newsArticle" target="_blank">
							<img src="./imgs/rtn_lvc.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Products-and-Services/Defense/Simulation-and-Training/Live-Virtual-Constructive-blended-test-and-training/Live-Virtual-and-Constructive.aspx" target="_blank">
							<img src="./imgs/cln_lvc.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>Near eye displays</td>
					<td>
						<img src="./imgs/cln_ImmersiveLabs.png" height="300" width="500"></img>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Products-and-Services/Defense/Simulation-and-Training/Products-and-Services/Simulation-and-Training-Helmet-Mounted-Display/SimEye-SX50TII-Helmet-Mounted-Display.aspx" target="_blank">
							<img src="./imgs/cln_hud.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>JTAC</td>
					<td>
						<a href="https://www.raytheon.com/news/feature/networked_soldier" target="_blank">
							<img src="./imgs/rtn_jtac.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Products-and-Services/Defense/Targeting/Simulation/RealFires.aspx" target="_blank">
							<img src="./imgs/cln_jtac.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>E-2</td>
					<td>
						<a href="https://aviationweek.com/awin/raytheon-has-completed-its-23-billion-acquisition-e-systems-inc" target="_blank">
							<img src="./imgs/rtn_e_systems.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<img src="./imgs/cln_ImmersiveLabs.png" height="300" width="500"></img>
					</td>
				</tr>
				<tr>
					<td>Joint Strike Fighter</td>
					<td>
						<a href="https://www.raytheon.com/news/feature/arming_the_f-35" target="_blank">
							<img src="./imgs/rtn_jsf.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="http://www.defense-aerospace.com/articles-view/release/3/202136/collins-australia-details-involvement-in-f_35-program.html" target="_blank">
							<img src="./imgs/cln_jsf.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>					
				<tr>
					<td>Commercial Airlines</td>
					<td>
						<a href="http://home.iwichita.com/rh1/hold/av/avhist/bch/raytheon.htm" target="_blank">
							<img src="./imgs/rtn_commair.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Products-and-Services/Commercial-Aviation.aspx" target="_blank">
							<img src="./imgs/cln_commair.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>Game Engine</td>
					<td>
						<a href="https://www.raytheon.com/news/feature/patriot-warfighter-machine-interface" target="_blank">
							<img src="./imgs/rtn_games.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.mro-network.com/maintenance-repair-overhaul/rockwell-collins-use-gaming-technology-keep-aircraft-flying" target="_blank">
							<img src="./imgs/cln_games.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>
				<tr>
					<td>Flight Simulator</td>
					<td>
						<a href="http://www.defense-aerospace.com/articles-view/release/3/1379/raytheon-sells-flight-simulation-business-%28jan.10%29.html" target="_blank">
							<img src="./imgs/rtn_flightsim.png" height="300" width="500"></img>
						</a>
					</td>
					<td>
						<a href="https://www.rockwellcollins.com/Data/News/2018-Cal-Yr/CS/20180426-TRU-Sim-Training-integrated-visual-system-commercial-flight-simulators.aspx" target="_blank">
							<img src="./imgs/cln_flightsim.png" height="300" width="500"></img>
						</a>
					</td>
				</tr>	
			</tbody>
		</table>
	</div>
	
	<div id="suppliersChart" class="suppliersChart" align="center">
	<p align="center" style="color:#E41A38; font-size:25px;"><b>Raytheon's Suppliers by Segment in Most Recent Quarter (Q2 - 2019) in %</b></p>
	<br>
		<table>
			<thead>
				<tr>
				<th>Supplier</th>
				<td>Missile Systems (Rev.)</td>
				<td>Network Centric Systems (Rev.)</td>
				<td>Space & Airborne Systems (Rev.)</td>
				<td>Integrated Defense Systems (Rev.)</td>
				<td>Intelligence & Information Systems (Rev.)</td>
				<td>Missile Systems (Inc.)</td>
				<td>Network Centric Systems (Inc.)</td>
				<td>Space & Airborne Systems (Inc.)</td>
				<td>Integrated Defense Systems (Inc.)</td>
				<td>Intelligence & Information Systems (Inc.)</td>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
	
	<div id="riskFactors" class="riskFactors" align="center">
		<div id="risk-tree"></div>
	</div>

</div>

<script>
  // Time
  var dataTime = d3.range(0, 17).map(function(d) {
    return new Date(2002 + d, 17, 3);
  });

  var sliderTime = d3
    .sliderBottom()
    .min(d3.min(dataTime))
    .max(d3.max(dataTime))
    .step(1000 * 60 * 60 * 24 * 365)
    .width(1300)
    .tickFormat(d3.timeFormat('%Y'))
    .tickValues(dataTime)
    .default(new Date(2002, 17, 3))
    .on('onchange', val => {
      d3.select('p#value-time').text(d3.timeFormat('%Y')(val)).style("font-size", "100px");
    });

  var gTime = d3
    .select('div#slider-time')
    .append('svg')
    .attr('width', 1500)
    .attr('height', 100)
    .append('g')
    .attr('transform', 'translate(30,10)');

  gTime.call(sliderTime);

  d3.select('p#value-time').text(d3.timeFormat('%Y')(sliderTime.value())).style("font-size", "100px");
</script>

<script>

var margin = {top: 550, right: 20, bottom: 30, left: 20},
    width = 1250,
    barHeight = 40,
    barWidth = (width - margin.left - margin.right) * 0.9;

var i = 0,
    duration = 400,
    root;

var diagonal = d3.linkHorizontal()
    .x(function(d) { return d.y; })
    .y(function(d) { return d.x; });

var svg = d3.select('div#risk-tree').append("svg")
    .attr("width", width) // + margin.left + margin.right)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.json("risks.json", function(error, risks) {
  if (error) throw error;
  root = d3.hierarchy(risks);
  root.x0 = 0;
  root.y0 = 0;
  update(root);
});

function update(source) {

  // Compute the flattened node list.
  var nodes = root.descendants();

  var height = Math.max(500, nodes.length * barHeight + margin.top + margin.bottom);

  d3.select('div#risk-tree').select("svg").transition()
      .duration(duration)
      .attr("height", height);

  d3.select(self.frameElement).transition()
      .duration(duration)
      .style("height", height + "px");

  var index = -1;
  root.eachBefore(function(n) {
    n.x = ++index * barHeight;
    n.y = n.depth * 20;
  });

  // Update the nodes…
  var node = svg.selectAll(".node")
    .data(nodes, function(d) { return d.id || (d.id = ++i); });

  var nodeEnter = node.enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + source.y0 + "," + source.x0 + ")"; })
      .style("opacity", 0);

  // Enter any new nodes at the parent's previous position.
  nodeEnter.append("rect")
      .attr("y", -barHeight / 2)
      .attr("height", barHeight)
      .attr("width", barWidth)
      .style("fill", color)
      .on("click", click);

  nodeEnter.append("text")
      .attr("dy", 3.5)
      .attr("dx", 20.5)
      .text(function(d) { return d.data.name; })
	  .style("font-size", "13px");

  // Transition nodes to their new position.
  nodeEnter.transition()
      .duration(duration)
      .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })
      .style("opacity", 1);

  node.transition()
      .duration(duration)
      .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })
      .style("opacity", 1)
    .select("rect")
      .style("fill", color);

  // Transition exiting nodes to the parent's new position.
  node.exit().transition()
      .duration(duration)
      .attr("transform", function(d) { return "translate(" + source.y + "," + source.x + ")"; })
      .style("opacity", 0)
      .remove();

  // Update the links…
  var link = svg.selectAll(".link")
    .data(root.links(), function(d) { return d.target.id; });

  // Enter any new links at the parent's previous position.
  link.enter().insert("path", "g")
      .attr("class", "link")
      .attr("d", function(d) {
        var o = {x: source.x0, y: source.y0};
        return diagonal({source: o, target: o});
      })
    .transition()
      .duration(duration)
      .attr("d", diagonal);

  // Transition links to their new position.
  link.transition()
      .duration(duration)
      .attr("d", diagonal);

  // Transition exiting nodes to the parent's new position.
  link.exit().transition()
      .duration(duration)
      .attr("d", function(d) {
        var o = {x: source.x, y: source.y};
        return diagonal({source: o, target: o});
      })
      .remove();

  // Stash the old positions for transition.
  root.each(function(d) {
    d.x0 = d.x;
    d.y0 = d.y;
  });
}

// Toggle children on click.
function click(d) {
  if (d.children) {
    d._children = d.children;
    d.children = null;
  } else {
    d.children = d._children;
    d._children = null;
  }
  update(d);
}

function color(d) {
	return d._children ? "#B80058" : d.children ? "#EDC5CB" : "#fd8d3c";
}

</script>

<script>
function dashboard(id, fData){
	var legendVals = ["BLL - Ball Corp.(Aerospace & technologies)", "TXT - Textron Inc. (Bell Segment)", "UTX - United Technologies Corp. (Sikorsky Segment)", "NOC-TA - Northrup Grumman Corp. (Total Aerospace)", "NOC-S - Northrup Grumman Corp. (Ships)"
					, "LMT-SS - Lockheed Martin Corp.(Space Systems)", "LMT-A - Lockheed Martin Corp.(Aeronautics)", "GD-MS - General Dynamics Corp. (Marine Systems)", "GD-CS - General Dynamics Corp. (Combat Systems)"
					, "BA - Boeing Co. (Precision Engagement and Mobility Systems)", "HII - Huntington Ingalls Industries, Inc.", "OA - Orbital ATK, Inc.", "PSSR - Passur Aerospace, Inc."
					, "SIF - Sifco Industries Inc.", "CYLU - Cyalume Technologies Holdings, Inc.", "AIR - Aar Corp.", "OSK - Oshkosh Corp.", "MTW - Manitowoc Co. Inc. (Marine)"];
	
	var svgLegned = d3.select(".customersChart").append("svg")
				.attr("width", 650)
				.attr("height", 530)
				.attr("transform", "translate(" + screen.width/96 + "," + "10" + ")");
			
	var dataL = 0;
	var offset = 300;
		
	var companyinfolegend = svgLegned.selectAll('.legends')
            .data(legendVals)
            .enter().append('g')
            .attr("class", "legends")
            .attr("transform", function (d, i) {
             if (i === 0) {
                dataL = d.length + offset 
                return "translate(0,0)"
            } else { 
             var newdataL = dataL
             dataL +=  d.length + offset
             return "translate(0," + (newdataL/10) + ")"
            }
        })
        
        companyinfolegend.append('text')
            .attr("x", 30)
            .attr("y", 15)
        //.attr("dy", ".35em")
        .text(function (d, i) {
            return d
        })
            .attr("class", "textselected")
            .style("text-anchor", "start")
            .style("font-size", 20)
			.style("font-weight","bold")
			.style("fill","black");

    var barColor = 'steelblue';
    function segColor(c){ return {spaceAndAirborneSystems:"#807dba", integratedDefenseSystems:"#e08214",intelligenceAndInformationSystems:"#41ab5d", missileSystems:"#a632a8", networkCentricSystems:"#75d422"}[c]; }
    
    // compute total for each state.
    fData.forEach(function(d){d.total=d.freq.spaceAndAirborneSystems+d.freq.integratedDefenseSystems+d.freq.intelligenceAndInformationSystems+d.freq.missileSystems+d.freq.networkCentricSystems;});
    
    // function to handle histogram.
    function histoGram(fD){
        var hG={},    hGDim = {t: 60, r: 0, b: 30, l: 0};
        hGDim.w = 850 - hGDim.l - hGDim.r, 
        hGDim.h = 400 - hGDim.t - hGDim.b;
            
        //create svg for histogram.
        var hGsvg = d3.select(id).append("svg")
            .attr("width", hGDim.w + hGDim.l + hGDim.r)
            .attr("height", hGDim.h + hGDim.t + hGDim.b).append("g")
            .attr("transform", "translate(" + hGDim.l + "," + hGDim.t + ")");

        // create function for x-axis mapping.
        var x = d3.scale.ordinal().rangeRoundBands([0, hGDim.w], 0.1)
                .domain(fD.map(function(d) { return d[0]; }));

        // Add x-axis to the histogram svg.
        hGsvg.append("g").attr("class", "x axis")
            .attr("transform", "translate(0," + hGDim.h + ")")
            .call(d3.axisBottom().scale(x));

        // Create function for y-axis map.
        var y = d3.scale.linear().range([hGDim.h, 0])
                .domain([0, d3.max(fD, function(d) { return d[1]; })]);

        // Create bars for histogram to contain rectangles and freq labels.
        var bars = hGsvg.selectAll(".bar").data(fD).enter()
                .append("g").attr("class", "bar");
        
        //create the rectangles.
        bars.append("rect")
            .attr("x", function(d) { return x(d[0]); })
            .attr("y", function(d) { return y(d[1]); })
            .attr("width", x.rangeBand())
            .attr("height", function(d) { return hGDim.h - y(d[1]); })
            .attr('fill',barColor)
            .on("mouseover",mouseover)// mouseover is defined below.
            .on("mouseout",mouseout);// mouseout is defined below.
            
        //Create the frequency labels above the rectangles.
        bars.append("text").text(function(d){ return d3.format(",")(d[1])})
            .attr("x", function(d) { return x(d[0])+x.rangeBand()/2; })
            .attr("y", function(d) { return y(d[1])-5; })
            .attr("text-anchor", "middle");
        
        function mouseover(d){  // utility function to be called on mouseover.
            // filter for selected state.
            var st = fData.filter(function(s){ return s.State == d[0];})[0],
                nD = d3.keys(st.freq).map(function(s){ return {type:s, freq:st.freq[s]};});
               
            // call update functions of pie-chart and legend.    
            pC.update(nD);
            leg.update(nD);
        }
        
        function mouseout(d){    // utility function to be called on mouseout.
            // reset the pie-chart and legend.    
            pC.update(tF);
            leg.update(tF);
        }
        
        // create function to update the bars. This will be used by pie-chart.
        hG.update = function(nD, color){
            // update the domain of the y-axis map to reflect change in frequencies.
            y.domain([0, d3.max(nD, function(d) { return d[1]; })]);
            
            // Attach the new data to the bars.
            var bars = hGsvg.selectAll(".bar").data(nD);
            
            // transition the height and color of rectangles.
            bars.select("rect").transition().duration(500)
                .attr("y", function(d) {return y(d[1]); })
                .attr("height", function(d) { return hGDim.h - y(d[1]); })
                .attr("fill", color);

            // transition the frequency labels location and change value.
            bars.select("text").transition().duration(500)
                .text(function(d){ return d3.format(",")(d[1])})
                .attr("y", function(d) {return y(d[1])-5; });            
        }        
        return hG;
    }
    
    // function to handle pieChart.
    function pieChart(pD){
        var pC ={},    pieDim ={w:250, h: 250};
        pieDim.r = Math.min(pieDim.w, pieDim.h) / 2;
                
        // create svg for pie chart.
        var piesvg = d3.select(id).append("svg")
            .attr("width", pieDim.w).attr("height", pieDim.h).append("g")
            .attr("transform", "translate("+pieDim.w/2+","+pieDim.h/2+")");
        
        // create function to draw the arcs of the pie slices.
        var arc = d3.arc().outerRadius(pieDim.r - 10).innerRadius(0);

        // create a function to compute the pie slice angles.
        var pie = d3.layout.pie().sort(null).value(function(d) { return d.freq; });

        // Draw the pie slices.
        piesvg.selectAll("path").data(pie(pD)).enter().append("path").attr("d", arc)
            .each(function(d) { this._current = d; })
            .style("fill", function(d) { return segColor(d.data.type); })
            .on("mouseover",mouseover).on("mouseout",mouseout);

        // create function to update pie-chart. This will be used by histogram.
        pC.update = function(nD){
            piesvg.selectAll("path").data(pie(nD)).transition().duration(500)
                .attrTween("d", arcTween);
        }        
        // Utility function to be called on mouseover a pie slice.
        function mouseover(d){
            // call the update function of histogram with new data.
            hG.update(fData.map(function(v){ 
                return [v.State,v.freq[d.data.type]];}),segColor(d.data.type));
        }
        //Utility function to be called on mouseout a pie slice.
        function mouseout(d){
            // call the update function of histogram with all data.
            hG.update(fData.map(function(v){
                return [v.State,v.total];}), barColor);
        }
        // Animating the pie-slice requiring a custom function which specifies
        // how the intermediate paths should be drawn.
        function arcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function(t) { return arc(i(t));    };
        }    
        return pC;
    }
    
    // function to handle legend.
    function legend(lD){
        var leg = {};
            
        // create table for legend.
        var legend = d3.select(id).append("table").attr('class','segmentlegend');
        
        // create one row per segment.
        var tr = legend.append("tbody").selectAll("tr").data(lD).enter().append("tr");
            
        // create the first column for each segment.
        tr.append("td").append("svg").attr("width", '16').attr("height", '16').append("rect")
            .attr("width", '16').attr("height", '16')
			.attr("fill",function(d){ return segColor(d.type); });
            
        // create the second column for each segment.
        tr.append("td").text(function(d){ return d.type;});

        // create the fourth column for each segment.
        tr.append("td").attr("class",'legendPerc')
            .text(function(d){ return getLegend(d,lD);});

        // Utility function to be used to update the legend.
        leg.update = function(nD){
            // update the data attached to the row elements.
            var l = legend.select("tbody").selectAll("tr").data(nD);

            // update the frequencies.
            l.select(".legendFreq").text(function(d){ return d3.format(",")(d.freq);});

            // update the percentage column.
            l.select(".legendPerc").text(function(d){ return getLegend(d,nD);});        
        }
        
        function getLegend(d,aD){ // Utility function to compute percentage.
            return d3.format("%")(d.freq/d3.sum(aD.map(function(v){ return v.freq; })));
        }

        return leg;
    }
    
    // total frequency by segment for all Customers.
    var tF = ['spaceAndAirborneSystems','integratedDefenseSystems','intelligenceAndInformationSystems','missileSystems','networkCentricSystems'].map(function(d){ 
        return {type:d, freq: d3.sum(fData.map(function(t){ return t.freq[d];}))}; 
    });    
    
    // calculate total frequency by state for all segment.
    var sF = fData.map(function(d){return [d.State,d.total];});

    var hG = histoGram(sF), // create the histogram.
        pC = pieChart(tF), // create the pie-chart.
        leg= legend(tF);  // create the legend.
}
</script>

<script>
var freqDataRevenue=[
	{State:'BLL'	,freq:{spaceAndAirborneSystems:9.7, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'TXT'	,freq:{spaceAndAirborneSystems:23.77, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'UTX'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'NOC-TA'	,freq:{spaceAndAirborneSystems:42.87, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'NOC-S'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'LMT-SS'	,freq:{spaceAndAirborneSystems:16.84, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'LMT-A'	,freq:{spaceAndAirborneSystems:34.21, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'GD-MS'	,freq:{spaceAndAirborneSystems:20.89, 	integratedDefenseSystems:20.89, intelligenceAndInformationSystems:20.89,missileSystems:20.89, 	networkCentricSystems:20.89}}
,	{State:'GD-CS'	,freq:{spaceAndAirborneSystems:24.47, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:24.47,missileSystems:0, 		networkCentricSystems:0}}
,	{State:'BA'		,freq:{spaceAndAirborneSystems:15.5, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'HII'	,freq:{spaceAndAirborneSystems:100, 	integratedDefenseSystems:100, 	intelligenceAndInformationSystems:100,	missileSystems:100, 	networkCentricSystems:100}}
,	{State:'OA'		,freq:{spaceAndAirborneSystems:100, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:100,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'PSSR'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'SIF'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'CYLU'	,freq:{spaceAndAirborneSystems:100, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:100,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'AIR'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:23.7, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'OSK'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:100,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'MTW'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
];

dashboard('#customersChart',freqDataRevenue);

var freqDataIncome=[
	{State:'BLL'	,freq:{spaceAndAirborneSystems:8.73, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'TXT'	,freq:{spaceAndAirborneSystems:48.29, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'UTX'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'NOC-TA'	,freq:{spaceAndAirborneSystems:41.74, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'NOC-S'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'LMT-SS'	,freq:{spaceAndAirborneSystems:16.95, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'LMT-A'	,freq:{spaceAndAirborneSystems:30.53, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'GD-MS'	,freq:{spaceAndAirborneSystems:25.38, 	integratedDefenseSystems:25.38, intelligenceAndInformationSystems:25.38,missileSystems:25.38, 	networkCentricSystems:25.38}}
,	{State:'GD-CS'	,freq:{spaceAndAirborneSystems:37.38, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:37.38 ,missileSystems:0, 		networkCentricSystems:0}}
,	{State:'BA'		,freq:{spaceAndAirborneSystems:18.15, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'HII'	,freq:{spaceAndAirborneSystems:100, 	integratedDefenseSystems:100, 	intelligenceAndInformationSystems:100,	missileSystems:100, 	networkCentricSystems:100}}
,	{State:'OA'		,freq:{spaceAndAirborneSystems:100, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:100,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'PSSR'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'SIF'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'CYLU'	,freq:{spaceAndAirborneSystems:100, 	integratedDefenseSystems:0, 	intelligenceAndInformationSystems:100,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'AIR'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:220.19, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'OSK'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:100,	missileSystems:0, 		networkCentricSystems:0}}
,	{State:'MTW'	,freq:{spaceAndAirborneSystems:0, 		integratedDefenseSystems:0, 	intelligenceAndInformationSystems:0,	missileSystems:0, 		networkCentricSystems:0}}
];

dashboard('#customersChart',freqDataIncome);

</script>

<script>

d3.csv("suppliers.csv", function(error, suppliers) {
  if (error) throw error;

  var ages = d3.keys(suppliers[0]).filter(function(key) {
    return key != "Supplier";
  });

  d3.selectAll("thead td").data(ages).on("click", function(k) {
    tr.sort(function(a, b) { return (b[k] / 105) - (a[k] / 105); });
  });

  var tr = d3.select("#suppliersChart").select("tbody").selectAll("tr")
      .data(suppliers)
    .enter().append("tr");

  tr.append("th")
      .text(function(d) { return d.Supplier; });
	  
  tr.selectAll("td")
      .data(function(d) { return ages.map(function(k) { return d[k]/105; }); })
    .enter().append("td").append("svg")
      .attr("width", 71)
      .attr("height", 12)
    .append("rect")
      .attr("height", 12)
      .attr("width", function(d) { return d * 71; });
	
	tr.selectAll("td").data(function(d) { return ages.map(function(k) { return d[k]/105; }); })
	.selectAll("svg")
	.append("text")
	.attr("text-anchor", "end")
	.attr("x", 50)
    .attr("y", 5)
    .attr("dy", ".35em")
	.text(function(d,i) { 
	return (d*105).toFixed(2); })
	.style('font-family', '"Open Sans", sans-serif')
	.style('font-weight', '500');
});
	
</script>

<script>
        const sunwidth = window.innerWidth,
            sunheight = window.innerHeight,
            maxRadius = (Math.min(sunwidth, sunheight) / 2) - 5;

        const formatNumber = d3.format(',d');

        const x = d3.scaleLinear()
            .range([0, 2 * Math.PI])
            .clamp(true);

        const y = d3.scaleSqrt()
            .range([maxRadius*.1, maxRadius]);

        const suncolor = d3.scaleOrdinal(d3.schemeCategory20b);

        const partition = d3.partition();

        const arc = d3.arc()
            .startAngle(d => x(d.x0))
            .endAngle(d => x(d.x1))
            .innerRadius(d => Math.max(0, y(d.y0)))
            .outerRadius(d => Math.max(0, y(d.y1)));

        const middleArcLine = d => {
            const halfPi = Math.PI/2;
            const angles = [x(d.x0) - halfPi, x(d.x1) - halfPi];
            const r = Math.max(0, (y(d.y0) + y(d.y1)) / 2);

            const middleAngle = (angles[1] + angles[0]) / 2;
            const invertDirection = middleAngle > 0 && middleAngle < Math.PI; // On lower quadrants write text ccw
            if (invertDirection) { angles.reverse(); }

            const path = d3.path();
            path.arc(0, 0, r, angles[0], angles[1], invertDirection);
            return path.toString();
        };

        const textFits = d => {
            const CHAR_SPACE = 6;

            const deltaAngle = x(d.x1) - x(d.x0);
            const r = Math.max(0, (y(d.y0) + y(d.y1)) / 2);
            const perimeter = r * deltaAngle;

            return d.data.name.length * CHAR_SPACE < perimeter;
        };

        const sunsvg = d3.select('body').select("#competitorChart").append('svg')
            .style('width', '100vw')
            .style('height', '100vh')
            .attr('viewBox', `${-sunwidth / 2} ${-sunheight / 2} ${sunwidth} ${sunheight}`)
            .on('click', () => focusOn()); // Reset zoom on canvas click

        d3.json('competitor.json', (error, root) => {
            if (error) throw error;

            root = d3.hierarchy(root);
            root.sum(d => d.size);

            const slice = sunsvg.selectAll('g.slice')
                .data(partition(root).descendants());

            slice.exit().remove();

            const newSlice = slice.enter()
                .append('g').attr('class', 'slice')
                .on('click', d => {
                    d3.event.stopPropagation();
                    focusOn(d);
                });

            newSlice.append('title')
                .text(d => d.data.name + '\n' + formatNumber(d.value));

            newSlice.append('path')
                .attr('class', 'main-arc')
                .style('fill', d => suncolor((d.children ? d : d.parent).data.name))
                .attr('d', arc);

            newSlice.append('path')
                .attr('class', 'hidden-arc')
                .attr('id', (_, i) => `hiddenArc${i}`)
                .attr('d', middleArcLine);

            const text = newSlice.append('text')
                .attr('display', d => textFits(d) ? null : 'none');

            // Add white contour
            text.append('textPath')
                .attr('startOffset','50%')
                .attr('xlink:href', (_, i) => `#hiddenArc${i}` )
                .text(d => d.data.name)
                .style('fill', 'none')
                .style('stroke', '#fff')
                .style('stroke-width', 5)
                .style('stroke-linejoin', 'round');

            text.append('textPath')
                .attr('startOffset','50%')
                .attr('xlink:href', (_, i) => `#hiddenArc${i}` )
                .text(d => d.data.name);
        });

        function focusOn(d = { x0: 0, x1: 1, y0: 0, y1: 1 }) {
            // Reset to top-level if no data point specified

            const transition = sunsvg.transition()
                .duration(750)
                .tween('scale', () => {
                    const xd = d3.interpolate(x.domain(), [d.x0, d.x1]),
                        yd = d3.interpolate(y.domain(), [d.y0, 1]);
                    return t => { x.domain(xd(t)); y.domain(yd(t)); };
                });

            transition.selectAll('path.main-arc')
                .attrTween('d', d => () => arc(d));

            transition.selectAll('path.hidden-arc')
                .attrTween('d', d => () => middleArcLine(d));

            transition.selectAll('text')
                .attrTween('display', d => () => textFits(d) ? null : 'none');

            moveStackToFront(d);

            //

            function moveStackToFront(elD) {
                sunsvg.selectAll('.slice').filter(d => d === elD)
                    .each(function(d) {
                        this.parentNode.appendChild(this);
                        if (d.parent) { moveStackToFront(d.parent); }
                    })
            }
        }
</script>

<script>
// ** Update info section (Called from the onchange)
function changeVisualInfo() {

    var selectBox = document.getElementById("topicSelection");
    var selectedValue = selectBox.options[selectBox.selectedIndex].value;
	var riskFactorPath = "";

	if(selectedValue==="t1")
	{
		document.getElementById("timeSlider").style.display = "none";
		document.getElementById("riskFactors").style.display = "none";
		document.getElementById("customersChart").style.display = "none";
		document.getElementById("suppliersChart").style.display = "none";
		document.getElementById("productsChart").style.display = "none";
		document.getElementById("overlapsChart").style.display = "none";
		document.getElementById("competitorChart").style.display = "block";
	}
	else if(selectedValue==="t2")
	{
		document.getElementById("timeSlider").style.display = "none";
		document.getElementById("competitorChart").style.display = "none";
		document.getElementById("riskFactors").style.display = "none";
		document.getElementById("suppliersChart").style.display = "none";
		document.getElementById("productsChart").style.display = "none";
		document.getElementById("overlapsChart").style.display = "none";
		document.getElementById("customersChart").style.display = "block";
	}
	else if(selectedValue==="t3")
	{
		document.getElementById("timeSlider").style.display = "none";
		document.getElementById("competitorChart").style.display = "none";
		document.getElementById("riskFactors").style.display = "none";
		document.getElementById("suppliersChart").style.display = "none";
		document.getElementById("productsChart").style.display = "none";
		document.getElementById("customersChart").style.display = "none";
		document.getElementById("overlapsChart").style.display = "block";
	}
	else if(selectedValue==="t5")
	{
		document.getElementById("timeSlider").style.display = "none";
		document.getElementById("competitorChart").style.display = "none";
		document.getElementById("riskFactors").style.display = "none";
		document.getElementById("suppliersChart").style.display = "none";
		document.getElementById("customersChart").style.display = "none";
		document.getElementById("overlapsChart").style.display = "none";
		document.getElementById("productsChart").style.display = "block";
	}
	else if(selectedValue==="t6")
	{
		document.getElementById("timeSlider").style.display = "none";
		document.getElementById("competitorChart").style.display = "none";
		document.getElementById("riskFactors").style.display = "none";
		document.getElementById("customersChart").style.display = "none";
		document.getElementById("productsChart").style.display = "none";
		document.getElementById("overlapsChart").style.display = "none";
		document.getElementById("suppliersChart").style.display = "block";
	}
	else if(selectedValue==="t7")
	{
		document.getElementById("timeSlider").style.display = "none";
		document.getElementById("competitorChart").style.display = "none";
		document.getElementById("customersChart").style.display = "none";
		document.getElementById("suppliersChart").style.display = "none";
		document.getElementById("productsChart").style.display = "none";
		document.getElementById("overlapsChart").style.display = "none";
		document.getElementById("riskFactors").style.display = "block";
	}
}
</script>

</body>
</html>